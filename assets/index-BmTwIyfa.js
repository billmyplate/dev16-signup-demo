var t=Object.defineProperty,__publicField=(e,r,n)=>((e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n)(e,"symbol"!=typeof r?r+"":r,n);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&processPreload(t)})).observe(document,{childList:!0,subtree:!0})}function processPreload(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var e=(t=>(t.INITIAL="initial",t.STORES_PAGE="stores-page",t.REGISTER_FORM="register-form",t.REGISTER_EXTENDED_FORM="register-extended-form",t.IN_OTP_FORM="otp-form",t.FINAL="final",t.ERROR="error",t))(e||{});class ApiService{constructor(){__publicField(this,"API_BASE_URL","https://dev16-bmp-api-dot-jstore-stg.uc.r.appspot.com")}async fetchConfirmationData(t,e){try{if(!t||!e)throw new Error("Invalid merchantId or pumpNumber");const r=await fetch(`${this.API_BASE_URL}/event/plate-detection/latest?merchantId=${t}&pumpNumber=${e}`);if(!r.ok)throw new Error(`Request failed: ${r.statusText}`);return await r.json()}catch(r){throw r}}async registerCustomer(t,e,r){if(!t||!e)throw new Error("Missing phone or creditCard");try{const n=await fetch(`${this.API_BASE_URL}/customer/${r?"register-full":"register"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:t,creditCard:e,...r||{}})});if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);return await n.json()}catch(n){throw n}}async verifySmsToken(t,e,r){try{if(!t||!e)throw new Error("Missing id or token");const{position:n,...i}=r||{},s=await fetch(`${this.API_BASE_URL}/customer/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,token:e,...r?{pumpData:{...i,...n}}:{}})});if(!s.ok)throw new Error(`Request failed: ${s.statusText}`);return await s.json()}catch(n){throw n}}async listStores(t){try{const e=await fetch(`${this.API_BASE_URL}/customer/stores?longitude=${t.longitude}&latitude=${t.latitude}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()}catch(e){throw e}}async getCardInfo(t){const e=function(t){const e=atob(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),i=new Uint8Array(n);for(let s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return new Blob([n],{type:r})}(t),r=new FormData;r.append("image",e,"card.jpeg");const n=await fetch(`${this.API_BASE_URL}/customer/read-card-info?provider=cloud-vision`,{method:"POST",body:r});if(!n.ok)throw new Error(`Error ${n.statusText}`);return await n.json()}}class BaseComponent{constructor(t){__publicField(this,"store"),__publicField(this,"state"),__publicField(this,"apiService",new ApiService),__publicField(this,"templates",Object.assign({"./canceled/canceled.template.html":'<section class="container">\r\n  <div class="col-container">\r\n    <h1 class="heading" id="main-heading">{message}</h1>\r\n\r\n    <button\r\n      id="closeBtn"\r\n      class="btn btn-primary"\r\n      aria-label="Close the form"\r\n      aria-labelledby="main-heading"\r\n    >\r\n      <span>Close</span>\r\n    </button>\r\n  </div>\r\n</section>\r\n',"./card-reader/card-reader.template.html":'\x3c!-- Card Reader Component --\x3e\r\n<div class="card-reader-container">\r\n  \x3c!-- Camera Viewport --\x3e\r\n  <div class="relative mb-4 overflow-hidden rounded-lg border border-gray-300 bg-gray-100">\r\n    \x3c!-- Camera feed --\x3e\r\n    <video id="camera-feed" class="h-64 w-full object-cover" autoplay playsinline></video>\r\n    \r\n    \x3c!-- Camera overlay with guidelines --\x3e\r\n    <div class="absolute inset-0 flex items-center justify-center">\r\n      <div class="h-40 w-64 rounded-md border-2 border-dashed border-navy-blue opacity-70">\r\n        <div class="absolute inset-0 flex flex-col items-center justify-center text-center text-navy-blue">\r\n          <span class="mb-1 text-sm font-medium">Position card within frame</span>\r\n          <span class="text-xs">Numbers facing up</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    \x3c!-- Loading spinner (hidden by default) --\x3e\r\n    <div id="processing-indicator" class="absolute inset-0 hidden items-center justify-center bg-black bg-opacity-50">\r\n      <div class="flex flex-col items-center">\r\n        <svg class="h-10 w-10 animate-spin text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\r\n          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\r\n          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\r\n        </svg>\r\n        <span class="mt-2 text-white">Processing...</span>\r\n      </div>\r\n    </div>\r\n    \r\n    \x3c!-- Camera error message (hidden by default) --\x3e\r\n    <div id="camera-error" class="absolute inset-0 hidden flex-col items-center justify-center bg-gray-200 p-4 text-center">\r\n      <svg xmlns="http://www.w3.org/2000/svg" class="mb-2 h-10 w-10 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">\r\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />\r\n      </svg>\r\n      <p class="text-sm font-medium text-gray-800">Camera access denied or not available</p>\r\n      <p class="mt-1 text-xs text-gray-600">Please allow camera access and try again</p>\r\n    </div>\r\n  </div>\r\n  \r\n  \x3c!-- Results Display --\x3e\r\n  <div  class="mb-4 rounded-md border border-gray-300 bg-gray-50 p-3">\r\n    <div class="grid grid-cols-2 gap-3">\r\n      <div>\r\n        <label class="block text-sm font-medium text-gray-700">Card Number</label>\r\n        <div id="card-number-result" class="mt-1 h-6 text-sm">Waiting for scan...</div>\r\n      </div>\r\n      <div>\r\n        <label class="block text-sm font-medium text-gray-700">Expiration Date</label>\r\n        <div id="expiration-date-result" class="mt-1 h-6 text-sm">Waiting for scan...</div>\r\n      </div>\r\n    </div>\r\n    \x3c!-- Error message (hidden by default) --\x3e\r\n    <div id="scan-error-message" class="mt-2 hidden rounded-md bg-red-50 p-2 text-xs text-red-600">\r\n      Unable to process image. Please try again with better lighting and alignment.\r\n    </div>\r\n  </div>\r\n  \r\n  \x3c!-- Control Buttons --\x3e\r\n  <div class="flex flex-col space-y-3">\r\n    \x3c!-- Capture Button (for manual mode) --\x3e\r\n    <button id="capture-button" type="button" class="btn btn-primary">\r\n      <svg class="mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">\r\n        <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />\r\n      </svg>\r\n      Capture Card Image\r\n    </button>\r\n    \r\n    \x3c!-- Accept Button (for when data is extracted) --\x3e\r\n    <button id="accept-button" type="button" class="btn btn-secondary hidden">\r\n      <svg class="mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">\r\n        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />\r\n      </svg>\r\n      Use These Details\r\n    </button>\r\n  </div>\r\n</div>\r\n',"./initial/initial.template.html":'<div class="container">\r\n  <div class="relative w-12 h-12">\r\n    <div\r\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-t-sunflower-yellow animate-spin"\r\n    >\r\n    \r\n  </div>\r\n    <div\r\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-b-navy-blue animate-[spin_1.5s_linear_reverse_infinite]"\r\n    ></div>\r\n  </div>\r\n</div>\r\n'})),this.store=t,this.state=t.getState()}handleDomAccessError(t){this.store.transitionTo(this.state.state)}$(t){const e=document.querySelector(t);return e||this.handleDomAccessError(t),e}$_all(t){const e=document.querySelectorAll(t);return 0===e.length&&this.handleDomAccessError(t),e}buildTemplatePath(){const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace("-component","");return`./${t}/${t}.template.html`}processTemplate(t,e){return t.replace(/\{([^{}]+)\}/g,((t,r)=>r.trim()in e?e[r.trim()]:""))}templateData(){return{}}render(){const t=this.buildTemplatePath();if(t in this.templates)try{const e=this.templates[t];return this.processTemplate(e,this.templateData())}catch(e){this.store.transitionTo(this.state.state)}return""}preventNonNumericValues(t,e){e.forEach((e=>{const r=t.querySelector(e);r.addEventListener("input",(()=>{r.value=r.value.replace(/\D/g,"")}))}))}attachEvents(){}}class InitialComponent extends BaseComponent{}var r,n={exports:{}};var i=(r||(r=1,function(t,e,r){var validate2=function(t,e,r){r=n.extend({},n.options,r);var i=n.runValidations(t,e,r);if(i.some((function(t){return n.isPromise(t.error)})))throw new Error("Use validate.async if you want support for promises");return validate2.processValidationResults(i,r)},n=validate2;n.extend=function(t){return[].slice.call(arguments,1).forEach((function(e){for(var r in e)t[r]=e[r]})),t},n.extend(validate2,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var t=n.format("%{major}.%{minor}.%{patch}",n.version);return n.isEmpty(n.version.metadata)||(t+="+"+n.version.metadata),t}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(t,e,r){var i,s,a,o,l,c,d,u=[];for(i in(n.isDomElement(t)||n.isJqueryElement(t))&&(t=n.collectFormValues(t)),e)for(s in a=n.getDeepObjectValue(t,i),o=n.result(e[i],a,t,i,r,e)){if(!(l=n.validators[s]))throw d=n.format("Unknown validator %{name}",{name:s}),new Error(d);c=o[s],(c=n.result(c,a,t,i,r,e))&&u.push({attribute:i,value:a,validator:s,globalOptions:r,attributes:t,options:c,error:l.call(l,a,c,i,t,r)})}return u},processValidationResults:function(t,e){t=n.pruneEmptyErrors(t,e),t=n.expandMultipleErrors(t,e),t=n.convertErrorMessages(t,e);var r=e.format||"grouped";if("function"!=typeof n.formatters[r])throw new Error(n.format("Unknown format %{format}",e));return t=n.formatters[r](t),n.isEmpty(t)?void 0:t},async:function(t,e,r){var i=(r=n.extend({},n.async.options,r)).wrapErrors||function(t){return t};!1!==r.cleanAttributes&&(t=n.cleanAttributes(t,e));var s=n.runValidations(t,e,r);return new n.Promise((function(a,o){n.waitForResults(s).then((function(){var l=n.processValidationResults(s,r);l?o(new i(l,r,t,e)):a(t)}),(function(t){o(t)}))}))},single:function(t,e,r){return r=n.extend({},n.single.options,r,{format:"flat",fullMessages:!1}),n({single:t},{single:e},r)},waitForResults:function(t){return t.reduce((function(t,e){return n.isPromise(e.error)?t.then((function(){return e.error.then((function(t){e.error=t||null}))})):t}),new n.Promise((function(t){t()})))},result:function(t){var e=[].slice.call(arguments,1);return"function"==typeof t&&(t=t.apply(null,e)),t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isFunction:function(t){return"function"==typeof t},isInteger:function(t){return n.isNumber(t)&&t%1==0},isBoolean:function(t){return"boolean"==typeof t},isObject:function(t){return t===Object(t)},isDate:function(t){return t instanceof Date},isDefined:function(t){return null!=t},isPromise:function(t){return!!t&&n.isFunction(t.then)},isJqueryElement:function(t){return t&&n.isString(t.jquery)},isDomElement:function(t){return!!t&&!(!t.querySelectorAll||!t.querySelector)&&(!(!n.isObject(document)||t!==document)||("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName))},isEmpty:function(t){var e;if(!n.isDefined(t))return!0;if(n.isFunction(t))return!1;if(n.isString(t))return n.EMPTY_STRING_REGEXP.test(t);if(n.isArray(t))return 0===t.length;if(n.isDate(t))return!1;if(n.isObject(t)){for(e in t)return!1;return!0}return!1},format:n.extend((function(t,e){return n.isString(t)?t.replace(n.format.FORMAT_REGEXP,(function(t,r,n){return"%"===r?"%{"+n+"}":String(e[n])})):t}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(t){return n.isNumber(t)?100*t%1==0?""+t:parseFloat(Math.round(100*t)/100).toFixed(2):n.isArray(t)?t.map((function(t){return n.prettify(t)})).join(", "):n.isObject(t)?n.isDefined(t.toString)?t.toString():JSON.stringify(t):(t=""+t).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(t,e,r){return e+" "+r.toLowerCase()})).toLowerCase()},stringifyValue:function(t,e){return(e&&e.prettify||n.prettify)(t)},isString:function(t){return"string"==typeof t},isArray:function(t){return"[object Array]"==={}.toString.call(t)},isHash:function(t){return n.isObject(t)&&!n.isArray(t)&&!n.isFunction(t)},contains:function(t,e){return!!n.isDefined(t)&&(n.isArray(t)?-1!==t.indexOf(e):e in t)},unique:function(t){return n.isArray(t)?t.filter((function(t,e,r){return r.indexOf(t)==e})):t},forEachKeyInKeypath:function(t,e,r){if(n.isString(e)){var i,s="",a=!1;for(i=0;i<e.length;++i)switch(e[i]){case".":a?(a=!1,s+="."):(t=r(t,s,!1),s="");break;case"\\":a?(a=!1,s+="\\"):a=!0;break;default:a=!1,s+=e[i]}return r(t,s,!0)}},getDeepObjectValue:function(t,e){if(n.isObject(t))return n.forEachKeyInKeypath(t,e,(function(t,e){if(n.isObject(t))return t[e]}))},collectFormValues:function(t,e){var r,i,s,a,o,l,c={};if(n.isJqueryElement(t)&&(t=t[0]),!t)return c;for(e=e||{},a=t.querySelectorAll("input[name], textarea[name]"),r=0;r<a.length;++r)if(s=a.item(r),!n.isDefined(s.getAttribute("data-ignored"))){var d=s.name.replace(/\./g,"\\\\.");l=n.sanitizeFormValue(s.value,e),"number"===s.type?l=l?+l:null:"checkbox"===s.type?s.attributes.value?s.checked||(l=c[d]||null):l=s.checked:"radio"===s.type&&(s.checked||(l=c[d]||null)),c[d]=l}for(a=t.querySelectorAll("select[name]"),r=0;r<a.length;++r)if(s=a.item(r),!n.isDefined(s.getAttribute("data-ignored"))){if(s.multiple)for(i in l=[],s.options)(o=s.options[i])&&o.selected&&l.push(n.sanitizeFormValue(o.value,e));else{var u=void 0!==s.options[s.selectedIndex]?s.options[s.selectedIndex].value:"";l=n.sanitizeFormValue(u,e)}c[s.name]=l}return c},sanitizeFormValue:function(t,e){return e.trim&&n.isString(t)&&(t=t.trim()),!1!==e.nullify&&""===t?null:t},capitalize:function(t){return n.isString(t)?t[0].toUpperCase()+t.slice(1):t},pruneEmptyErrors:function(t){return t.filter((function(t){return!n.isEmpty(t.error)}))},expandMultipleErrors:function(t){var e=[];return t.forEach((function(t){n.isArray(t.error)?t.error.forEach((function(r){e.push(n.extend({},t,{error:r}))})):e.push(t)})),e},convertErrorMessages:function(t,e){var r=[],i=(e=e||{}).prettify||n.prettify;return t.forEach((function(t){var s=n.result(t.error,t.value,t.attribute,t.options,t.attributes,t.globalOptions);n.isString(s)?("^"===s[0]?s=s.slice(1):!1!==e.fullMessages&&(s=n.capitalize(i(t.attribute))+" "+s),s=s.replace(/\\\^/g,"^"),s=n.format(s,{value:n.stringifyValue(t.value,e)}),r.push(n.extend({},t,{error:s}))):r.push(t)})),r},groupErrorsByAttribute:function(t){var e={};return t.forEach((function(t){var r=e[t.attribute];r?r.push(t):e[t.attribute]=[t]})),e},flattenErrorsToArray:function(t){return t.map((function(t){return t.error})).filter((function(t,e,r){return r.indexOf(t)===e}))},cleanAttributes:function(t,e){function whitelistCreator(t,e,r){return n.isObject(t[e])?t[e]:t[e]=!!r||{}}return n.isObject(e)&&n.isObject(t)?function cleanRecursive(t,e){if(!n.isObject(t))return t;var r,i,s=n.extend({},t);for(i in t)r=e[i],n.isObject(r)?s[i]=cleanRecursive(s[i],r):r||delete s[i];return s}(t,e=function(t){var e,r={};for(e in t)t[e]&&n.forEachKeyInKeypath(r,e,whitelistCreator);return r}(e)):{}},exposeModule:function(t,e,r,n,i){r?(n&&n.exports&&(r=n.exports=t),r.validate=t):(e.validate=t,t.isFunction(i)&&i.amd&&i([],(function(){return t})))},warn:function(t){"undefined"!=typeof console&&console.warn},error:function(t){"undefined"!=typeof console&&console.error}}),validate2.validators={presence:function(t,e){if(!1!==(e=n.extend({},this.options,e)).allowEmpty?!n.isDefined(t):n.isEmpty(t))return e.message||this.message||"can't be blank"},length:function(t,e,r){if(n.isDefined(t)){var i,s=(e=n.extend({},this.options,e)).is,a=e.maximum,o=e.minimum,l=[],c=(t=(e.tokenizer||function(t){return t})(t)).length;return n.isNumber(c)?(n.isNumber(s)&&c!==s&&(i=e.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",l.push(n.format(i,{count:s}))),n.isNumber(o)&&c<o&&(i=e.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",l.push(n.format(i,{count:o}))),n.isNumber(a)&&c>a&&(i=e.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",l.push(n.format(i,{count:a}))),l.length>0?e.message||l:void 0):e.message||this.notValid||"has an incorrect length"}},numericality:function(t,e,r,i,s){if(n.isDefined(t)){var a,o,l=[],c={greaterThan:function(t,e){return t>e},greaterThanOrEqualTo:function(t,e){return t>=e},equalTo:function(t,e){return t===e},lessThan:function(t,e){return t<e},lessThanOrEqualTo:function(t,e){return t<=e},divisibleBy:function(t,e){return t%e==0}},d=(e=n.extend({},this.options,e)).prettify||s&&s.prettify||n.prettify;if(n.isString(t)&&e.strict){var u="^-?(0|[1-9]\\d*)";if(e.onlyInteger||(u+="(\\.\\d+)?"),u+="$",!new RegExp(u).test(t))return e.message||e.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==e.noStrings&&n.isString(t)&&!n.isEmpty(t)&&(t=+t),!n.isNumber(t))return e.message||e.notValid||this.notValid||this.message||"is not a number";if(e.onlyInteger&&!n.isInteger(t))return e.message||e.notInteger||this.notInteger||this.message||"must be an integer";for(a in c)if(o=e[a],n.isNumber(o)&&!c[a](t,o)){var p="not"+n.capitalize(a),m=e[p]||this[p]||this.message||"must be %{type} %{count}";l.push(n.format(m,{count:o,type:d(a)}))}return e.odd&&t%2!=1&&l.push(e.notOdd||this.notOdd||this.message||"must be odd"),e.even&&t%2!=0&&l.push(e.notEven||this.notEven||this.message||"must be even"),l.length?e.message||l:void 0}},datetime:n.extend((function(t,e){if(!n.isFunction(this.parse)||!n.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(n.isDefined(t)){var r,i=[],s=(e=n.extend({},this.options,e)).earliest?this.parse(e.earliest,e):NaN,a=e.latest?this.parse(e.latest,e):NaN;return t=this.parse(t,e),isNaN(t)||e.dateOnly&&t%864e5!=0?(r=e.notValid||e.message||this.notValid||"must be a valid date",n.format(r,{value:arguments[0]})):(!isNaN(s)&&t<s&&(r=e.tooEarly||e.message||this.tooEarly||"must be no earlier than %{date}",r=n.format(r,{value:this.format(t,e),date:this.format(s,e)}),i.push(r)),!isNaN(a)&&t>a&&(r=e.tooLate||e.message||this.tooLate||"must be no later than %{date}",r=n.format(r,{date:this.format(a,e),value:this.format(t,e)}),i.push(r)),i.length?n.unique(i):void 0)}}),{parse:null,format:null}),date:function(t,e){return e=n.extend({},e,{dateOnly:!0}),n.validators.datetime.call(n.validators.datetime,t,e)},format:function(t,e){(n.isString(e)||e instanceof RegExp)&&(e={pattern:e});var r,i=(e=n.extend({},this.options,e)).message||this.message||"is invalid",s=e.pattern;if(n.isDefined(t))return n.isString(t)?(n.isString(s)&&(s=new RegExp(e.pattern,e.flags)),(r=s.exec(t))&&r[0].length==t.length?void 0:i):i},inclusion:function(t,e){if(n.isDefined(t)&&(n.isArray(e)&&(e={within:e}),e=n.extend({},this.options,e),!n.contains(e.within,t))){var r=e.message||this.message||"^%{value} is not included in the list";return n.format(r,{value:t})}},exclusion:function(t,e){if(n.isDefined(t)&&(n.isArray(e)&&(e={within:e}),e=n.extend({},this.options,e),n.contains(e.within,t))){var r=e.message||this.message||"^%{value} is restricted";return n.isString(e.within[t])&&(t=e.within[t]),n.format(r,{value:t})}},email:n.extend((function(t,e){var r=(e=n.extend({},this.options,e)).message||this.message||"is not a valid email";if(n.isDefined(t))return n.isString(t)&&this.PATTERN.exec(t)?void 0:r}),{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(t,e,r,i,s){if(n.isDefined(t)){n.isString(e)&&(e={attribute:e});var a=(e=n.extend({},this.options,e)).message||this.message||"is not equal to %{attribute}";if(n.isEmpty(e.attribute)||!n.isString(e.attribute))throw new Error("The attribute must be a non empty string");var o=n.getDeepObjectValue(i,e.attribute),l=e.comparator||function(t,e){return t===e},c=e.prettify||s&&s.prettify||n.prettify;return l(t,o,e,r,i)?void 0:n.format(a,{attribute:c(e.attribute)})}},url:function(t,e){if(n.isDefined(t)){var r=(e=n.extend({},this.options,e)).message||this.message||"is not a valid url",i=e.schemes||this.schemes||["http","https"],s=e.allowLocal||this.allowLocal||!1,a=e.allowDataUrl||this.allowDataUrl||!1;if(!n.isString(t))return r;var o="^(?:(?:"+i.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return s?l+="?":o+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",o+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",a&&(o="(?:"+o+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(o,"i").exec(t)?void 0:r}},type:n.extend((function(t,e,r,i,s){if(n.isString(e)&&(e={type:e}),n.isDefined(t)){var a,o=n.extend({},this.options,e),l=o.type;if(!n.isDefined(l))throw new Error("No type was specified");if(a=n.isFunction(l)?l:this.types[l],!n.isFunction(a))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!a(t,o,r,i,s)){var c=e.message||this.messages[l]||this.message||o.message||(n.isFunction(l)?"must be of the correct type":"must be of type %{type}");return n.isFunction(c)&&(c=c(t,e,r,i,s)),n.format(c,{attribute:n.prettify(r),type:l})}}}),{types:{object:function(t){return n.isObject(t)&&!n.isArray(t)},array:n.isArray,integer:n.isInteger,number:n.isNumber,string:n.isString,date:n.isDate,boolean:n.isBoolean},messages:{}})},validate2.formatters={detailed:function(t){return t},flat:n.flattenErrorsToArray,grouped:function(t){var e;for(e in t=n.groupErrorsByAttribute(t))t[e]=n.flattenErrorsToArray(t[e]);return t},constraint:function(t){var e;for(e in t=n.groupErrorsByAttribute(t))t[e]=t[e].map((function(t){return t.validator})).sort();return t}},validate2.exposeModule(validate2,this,t,e,r)}.call(n.exports,n.exports,n,null)),n.exports);class PageBaseComponent extends BaseComponent{constructor(t){super(t),this.templates=Object.assign({"./final/final.template.html":'<div class="container">\r\n  <div class="col-container">\r\n    <img\r\n      role="img"\r\n      class="w-full h-64 md:h-80 object-cover rounded-lg"\r\n      src="pump.svg"\r\n      alt="Illustration of a gas pump"\r\n      aria-describedby="pump-instructions"\r\n    />\r\n\r\n    <h1 id="pump-instructions" class="heading">\r\n      Pump authorized successfully \r\n    </h1>\r\n  </div>\r\n</div>\r\n',"./otp-form/otp-form.template.html":'<div class="container">\r\n  <div\r\n    class="form col-container border border-gray-200 shadow-sm justify-between"\r\n  >\r\n    <div class="col-container">\r\n      <div class="font-semibold text-3xl">\r\n        <p>Phone Verification</p>\r\n      </div>\r\n      <div class="flex flex-row text-sm font-medium text-gray-400">\r\n        <p>We have sent a code to your phone number</p>\r\n      </div>\r\n    </div>\r\n\r\n    <form class="form">\r\n      <div\r\n        class="flex flex-row items-center justify-between mx-auto w-full gap-1 my-5"\r\n      >\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n        <div class="w-16 h-16">\r\n          <input\r\n            name="otp"\r\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\r\n            type="number"\r\n            min="0"\r\n            max="9"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <button class="btn btn-primary w-full">Verify</button>\r\n    </form>\r\n    <span id="error" class="error mx-auto" role="alert"></span>\r\n  </div>\r\n</div>\r\n',"./register-extended-form/register-extended-form.template.html":'<section class="container">\r\n    <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\r\n      <div class="mx-auto max-w-5xl">\r\n        <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\r\n          <form class="form bordered-form" aria-labelledby="credit-card-form">\r\n            <h2 id="credit-card-form" class="sr-only">Register to authorize pump</h2>\r\n\r\n            \x3c!-- New Fields --\x3e\r\n            <div class="mb-6 grid grid-cols-2 gap-4">\r\n              \x3c!-- First Name --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label for="first-name" class="mb-2 block text-sm font-medium">First Name*</label>\r\n                <input\r\n                  type="text"\r\n                  id="first-name"\r\n                  class="form-input"\r\n                  placeholder="John"\r\n                  aria-required="true"\r\n                />\r\n              </div>\r\n\r\n              \x3c!-- Last Name --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label for="last-name" class="mb-2 block text-sm font-medium">Last Name*</label>\r\n                <input\r\n                  type="text"\r\n                  id="last-name"\r\n                  class="form-input"\r\n                  placeholder="Doe"\r\n                  aria-required="true"\r\n                />\r\n              </div>\r\n\r\n              \x3c!-- Email --\x3e\r\n              <div class="col-span-2">\r\n                <label for="email" class="mb-2 block text-sm font-medium">Email*</label>\r\n                <input\r\n                  type="email"\r\n                  id="email"\r\n                  class="form-input"\r\n                  placeholder="example@example.com"\r\n                  aria-required="true"\r\n                />\r\n              </div>\r\n\r\n              \x3c!-- Password --\x3e\r\n              <div class="col-span-2">\r\n                <label for="password" class="mb-2 block text-sm font-medium">Password*</label>\r\n                <input\r\n                  type="password"\r\n                  id="password"\r\n                  class="form-input"\r\n                  placeholder="••••••••"\r\n                  aria-required="true"\r\n                />\r\n              </div>\r\n\r\n              \x3c!-- Pin Code --\x3e\r\n              <div class="col-span-2">\r\n                <label for="pin-code" class="mb-2 block text-sm font-medium">Pin Code*</label>\r\n                <input\r\n                  type="password"\r\n                  id="pin-code"\r\n                  class="form-input"\r\n                  maxlength="4"\r\n                  placeholder="1234"\r\n                  aria-required="true"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div class="mb-6 grid grid-cols-1 gap-4">\r\n              \x3c!-- Mobile Phone Input --\x3e\r\n              <div class="col-span-1">\r\n                <label\r\n                  for="mobile-phone-input"\r\n                  class="mb-2 block text-sm font-medium"\r\n                  >Mobile Phone*</label\r\n                >\r\n                <input\r\n                  type="tel"\r\n                  id="mobile-phone-input"\r\n                  class="form-input"\r\n                  inputmode="tel"\r\n                  placeholder="(123) 456-7890"\r\n                  aria-required="true"\r\n                  aria-describedby="mobile-phone-description"\r\n                />\r\n                <span id="mobile-phone-description" class="sr-only">\r\n                  Enter your 10-digit mobile phone number.\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            \r\n          <div class="mb-6 grid grid-cols-1 gap-4">\r\n            \x3c!-- Pump Number Dropdown --\x3e\r\n            <div class="col-span-1">\r\n              <label for="pump-number" class="mb-2 block text-sm font-medium text-gray-700">\r\n                Pump Number*\r\n              </label>\r\n              <select\r\n                id="pump-number"\r\n                class="form-select w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50 hover:border-gray-400"\r\n                aria-required="true"\r\n                aria-describedby="pump-number-description"\r\n              >\r\n                \x3c!-- Options will be dynamically populated --\x3e\r\n              </select>\r\n              <span id="pump-number-description" class="sr-only">\r\n                Select the pump number you want to authorize.\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n            <div class="mb-6 grid grid-cols-2 gap-4">\r\n              \x3c!-- Card Number Input --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label\r\n                  for="card-number-input"\r\n                  class="mb-2 block text-sm font-medium"\r\n                  >Card number*</label\r\n                >\r\n                <div class="relative flex items-center">\r\n                  <input\r\n                    type="text"\r\n                    class="form-input w-full"\r\n                    aria-required="true"\r\n                    inputmode="numeric"\r\n                    id="card-number-input"\r\n                    placeholder="xxxx-xxxx-xxxx-xxxx"\r\n                    aria-describedby="card-number-description"\r\n                  />\r\n                  <button\r\n                    type="button"\r\n                    id="scan-card-btn"\r\n                    class="absolute right-2 p-1 text-gray-500 hover:text-navy-blue"\r\n                    aria-label="Scan credit card with camera"\r\n                  >\r\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">\r\n                      <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4z" clip-rule="evenodd" />\r\n                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n                <span id="card-number-description" class="sr-only">\r\n                  Enter your 16-digit card number without spaces or dashes.\r\n                </span>\r\n              </div>\r\n              \x3c!-- Zipcode Input --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label for="zipcode" class="mb-2 block text-sm font-medium"\r\n                  >Zipcode*</label\r\n                >\r\n                <input\r\n                  type="text"\r\n                  id="zipcode"\r\n                  maxlength="5"\r\n                  class="form-input"\r\n                  inputmode="numeric"\r\n                  placeholder="12345"\r\n                  aria-required="true"\r\n                  aria-describedby="zipcode-description"\r\n                />\r\n                <span id="zipcode-description" class="sr-only">\r\n                  Enter a 5-digit ZIP code.\r\n                </span>\r\n              </div>\r\n\r\n              \x3c!-- Card Expiration Input --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label\r\n                  for="card-expiration-input"\r\n                  class="mb-2 block text-sm font-medium"\r\n                  >Card expiration*</label\r\n                >\r\n                <div class="relative">\r\n                  <input\r\n                    type="text"\r\n                    class="form-input"\r\n                    placeholder="MM/YY"\r\n                    inputmode="numeric"\r\n                    aria-required="true"\r\n                    id="card-expiration-input"\r\n                    aria-describedby="card-expiration-description"\r\n                  />\r\n                  <span id="card-expiration-description" class="sr-only">\r\n                    Enter the expiration date in MM/YY format.\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              \x3c!-- CVV Input with Tooltip --\x3e\r\n              <div class="col-span-2 sm:col-span-1">\r\n                <label for="cvv-input" class="mb-2 block text-sm font-medium">\r\n                  CVV*\r\n                  <button\r\n                    type="button"\r\n                    class="relative group"\r\n                    aria-label="CVV information"\r\n                  >\r\n                    <svg\r\n                      aria-hidden="true"\r\n                      fill="currentColor"\r\n                      viewBox="0 0 24 24"\r\n                      xmlns="http://www.w3.org/2000/svg"\r\n                      class="h-4 w-4 text-gray-400 hover:text-navy-blue"\r\n                    >\r\n                      <path\r\n                        fill-rule="evenodd"\r\n                        clip-rule="evenodd"\r\n                        d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.408-5.5a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4a1 1 0 0 0-1-1h-2Z"\r\n                      />\r\n                    </svg>\r\n                    <span\r\n                      role="tooltip"\r\n                      aria-hidden="true"\r\n                      class="absolute left-1/2 top-full mt-1 hidden w-max -translate-x-1/2 rounded-lg bg-navy-blue px-3 py-2 text-sm font-medium text-white shadow-md group-hover:block"\r\n                    >\r\n                      The last 3-4 digits on the back of the card\r\n                    </span>\r\n                  </button>\r\n                </label>\r\n                <input\r\n                  type="text"\r\n                  id="cvv-input"\r\n                  maxlength="4"\r\n                  placeholder="•••"\r\n                  class="form-input"\r\n                  inputmode="numeric"\r\n                  aria-required="true"\r\n                  aria-describedby="cvv-description"\r\n                />\r\n                <span id="cvv-description" class="sr-only">\r\n                  Enter the 3-digit security code found on the back of your card.\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            \x3c!-- Submit Button --\x3e\r\n            <button\r\n              type="submit"\r\n              aria-label="Register"\r\n              class="btn btn-primary w-full"\r\n            >\r\n              Submit\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <span id="error" class="error" role="alert"></span>\r\n  </section>\r\n\r\n  \x3c!-- Modal - initially hidden --\x3e\r\n<div id="modal-container" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">\r\n  \x3c!-- Overlay background --\x3e\r\n  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>\r\n  \r\n  \x3c!-- Modal content --\x3e\r\n  <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">\r\n    <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">\r\n      \x3c!-- Modal header with close button --\x3e\r\n      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">\r\n        <div class="flex items-start justify-between">\r\n          <h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title"></h3>\r\n          <button type="button" id="modal-close-icon" class="modal-close rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none">\r\n            <span class="sr-only">Close</span>\r\n            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\r\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div id="modal-content" class="mt-3">\r\n          \x3c!-- Modal content will be dynamically inserted here --\x3e\r\n        </div>\r\n      </div>\r\n      \r\n      \x3c!-- Modal footer --\x3e\r\n      <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">\r\n        <button id="modal-close-btn" type="button" class="modal-close btn btn-secondary">Close</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>',"./register-form/register-form.template.html":'<section class="container">\r\n  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\r\n    <div class="mx-auto max-w-5xl">\r\n      <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\r\n        <form class="form bordered-form" aria-labelledby="credit-card-form">\r\n          <h2 id="credit-card-form" class="sr-only">Register to authorize pump</h2>\r\n\r\n          <div class="mb-6 grid grid-cols-1 gap-4">\r\n            \x3c!-- Mobile Phone Input --\x3e\r\n            <div class="col-span-1">\r\n              <label\r\n                for="mobile-phone-input"\r\n                class="mb-2 block text-sm font-medium"\r\n                >Mobile Phone*</label\r\n              >\r\n              <input\r\n                type="tel"\r\n                id="mobile-phone-input"\r\n                class="form-input"\r\n                inputmode="tel"\r\n                placeholder="(123) 456-7890"\r\n                aria-required="true"\r\n                aria-describedby="mobile-phone-description"\r\n              />\r\n              <span id="mobile-phone-description" class="sr-only">\r\n                Enter your 10-digit mobile phone number.\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class="mb-6 grid grid-cols-1 gap-4">\r\n            \x3c!-- Pump Number Dropdown --\x3e\r\n            <div class="col-span-1">\r\n              <label for="pump-number" class="mb-2 block text-sm font-medium text-gray-700">\r\n                Pump Number*\r\n              </label>\r\n              <select\r\n                id="pump-number"\r\n                class="form-select w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50 hover:border-gray-400"\r\n                aria-required="true"\r\n                aria-describedby="pump-number-description"\r\n              >\r\n                \x3c!-- Options will be dynamically populated --\x3e\r\n              </select>\r\n              <span id="pump-number-description" class="sr-only">\r\n                Select the pump number you want to authorize.\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class="mb-6 grid grid-cols-2 gap-4">\r\n            \x3c!-- Card Number Input --\x3e\r\n            <div class="col-span-2 sm:col-span-1">\r\n              <label\r\n                for="card-number-input"\r\n                class="mb-2 block text-sm font-medium"\r\n                >Card number*</label\r\n              >\r\n              <div class="relative flex items-center">\r\n                <input\r\n                  type="text"\r\n                  class="form-input w-full"\r\n                  aria-required="true"\r\n                  inputmode="numeric"\r\n                  id="card-number-input"\r\n                  placeholder="xxxx-xxxx-xxxx-xxxx"\r\n                  aria-describedby="card-number-description"\r\n                />\r\n                <button\r\n                  type="button"\r\n                  id="scan-card-btn"\r\n                  class="absolute right-2 p-1 text-gray-500 hover:text-navy-blue"\r\n                  aria-label="Scan credit card with camera"\r\n                >\r\n                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">\r\n                    <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4z" clip-rule="evenodd" />\r\n                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n              <span id="card-number-description" class="sr-only">\r\n                Enter your 16-digit card number without spaces or dashes.\r\n              </span>\r\n            </div>\r\n\r\n            \x3c!-- Zipcode Input --\x3e\r\n            <div class="col-span-2 sm:col-span-1">\r\n              <label for="zipcode" class="mb-2 block text-sm font-medium"\r\n                >Zipcode*</label\r\n              >\r\n              <input\r\n                type="text"\r\n                id="zipcode"\r\n                maxlength="5"\r\n                class="form-input"\r\n                inputmode="numeric"\r\n                placeholder="12345"\r\n                aria-required="true"\r\n                aria-describedby="zipcode-description"\r\n              />\r\n              <span id="zipcode-description" class="sr-only">\r\n                Enter a 5-digit ZIP code.\r\n              </span>\r\n            </div>\r\n\r\n            \x3c!-- Card Expiration Input --\x3e\r\n            <div class="col-span-2 sm:col-span-1">\r\n              <label\r\n                for="card-expiration-input"\r\n                class="mb-2 block text-sm font-medium"\r\n                >Card expiration*</label\r\n              >\r\n              <div class="relative">\r\n                <input\r\n                  type="text"\r\n                  class="form-input"\r\n                  placeholder="MM/YY"\r\n                  inputmode="numeric"\r\n                  aria-required="true"\r\n                  id="card-expiration-input"\r\n                  aria-describedby="card-expiration-description"\r\n                />\r\n                <span id="card-expiration-description" class="sr-only">\r\n                  Enter the expiration date in MM/YY format.\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            \x3c!-- CVV Input with Tooltip --\x3e\r\n            <div class="col-span-2 sm:col-span-1">\r\n              <label for="cvv-input" class="mb-2 block text-sm font-medium">\r\n                CVV*\r\n                <button\r\n                  type="button"\r\n                  class="relative group"\r\n                  aria-label="CVV information"\r\n                >\r\n                  <svg\r\n                    aria-hidden="true"\r\n                    fill="currentColor"\r\n                    viewBox="0 0 24 24"\r\n                    xmlns="http://www.w3.org/2000/svg"\r\n                    class="h-4 w-4 text-gray-400 hover:text-navy-blue"\r\n                  >\r\n                    <path\r\n                      fill-rule="evenodd"\r\n                      clip-rule="evenodd"\r\n                      d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.408-5.5a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4a1 1 0 0 0-1-1h-2Z"\r\n                    />\r\n                  </svg>\r\n                  <span\r\n                    role="tooltip"\r\n                    aria-hidden="true"\r\n                    class="absolute left-1/2 top-full mt-1 hidden w-max -translate-x-1/2 rounded-lg bg-navy-blue px-3 py-2 text-sm font-medium text-white shadow-md group-hover:block"\r\n                  >\r\n                    The last 3-4 digits on the back of the card\r\n                  </span>\r\n                </button>\r\n              </label>\r\n              <input\r\n                type="text"\r\n                id="cvv-input"\r\n                maxlength="4"\r\n                placeholder="•••"\r\n                class="form-input"\r\n                inputmode="numeric"\r\n                aria-required="true"\r\n                aria-describedby="cvv-description"\r\n              />\r\n              <span id="cvv-description" class="sr-only">\r\n                Enter the 3-digit security code found on the back of your card.\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          \x3c!-- Submit Button --\x3e\r\n          <button\r\n            type="submit"\r\n            aria-label="Register"\r\n            class="btn btn-primary w-full"\r\n          >\r\n            Submit\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <span id="error" class="error" role="alert"></span>\r\n</section>\r\n\r\n\x3c!-- Modal - initially hidden --\x3e\r\n<div id="modal-container" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">\r\n  \x3c!-- Overlay background --\x3e\r\n  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>\r\n  \r\n  \x3c!-- Modal content --\x3e\r\n  <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">\r\n    <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">\r\n      \x3c!-- Modal header with close button --\x3e\r\n      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">\r\n        <div class="flex items-start justify-between">\r\n          <h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title"></h3>\r\n          <button type="button" id="modal-close-icon" class="modal-close rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none">\r\n            <span class="sr-only">Close</span>\r\n            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\r\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div id="modal-content" class="mt-3">\r\n          \x3c!-- Modal content will be dynamically inserted here --\x3e\r\n        </div>\r\n      </div>\r\n      \r\n      \x3c!-- Modal footer --\x3e\r\n      <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">\r\n        <button id="modal-close-btn" type="button" class="modal-close btn btn-secondary">Close</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n',"./store-card/store-card.template.html":'<div class="mx-auto max-w-screen-xl px-4 2xl:px-0 transition-transform duration-300 hover:scale-105 hover:shadow-lg cursor-pointer" id="id-{storeId}">\r\n  <div class="mx-auto max-w-5xl">\r\n    <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\r\n      <div class="border p-6 rounded-lg shadow-md w-full">\r\n        <h2 class="text-lg font-semibold mb-4 text-navy-blue">\r\n          Store Details\r\n        </h2>\r\n\r\n        <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 gap-4">\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Store Name</p>\r\n            <p class="text-base font-semibold text-gray-900">{storeName}</p>\r\n          </div>\r\n          \x3c!-- <div>\r\n            <p class="text-sm font-medium text-gray-600">Store ID</p>\r\n            <p class="text-base font-semibold text-gray-900">{storeId}</p>\r\n          </div> --\x3e\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Store Number</p>\r\n            <p class="text-base font-semibold text-gray-900">{storeNumber}</p>\r\n          </div>\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Fuel Brand</p>\r\n            <p class="text-base font-semibold text-gray-900">{fuelBrand}</p>\r\n          </div>\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Phone</p>\r\n            <p class="text-base font-semibold text-gray-900">{phone}</p>\r\n          </div>\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Number of Pumps</p>\r\n            <p class="text-base font-semibold text-gray-900">{numberOfPumps}</p>\r\n          </div>\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Online Status</p>\r\n            <p class="text-base font-semibold text-green-600">\r\n              {isOnline}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="mt-4 border-t pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Address</p>\r\n            <p class="text-base font-semibold text-gray-900">\r\n              {streetAddress}, {city}, {stateCode}\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <p class="text-sm font-medium text-gray-600">Geo Location</p>\r\n            <p class="text-base font-semibold text-gray-900">\r\n              Lat: {latitude}, Long: {longitude}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n',"./stores/stores.template.html":'<section class="container py-8">\r\n  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\r\n    <h1 class="text-2xl font-bold mb-6 text-navy-blue">Available Stores</h1>\r\n\r\n    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">\r\n      \x3c!-- Loop through stores and render store-card --\x3e\r\n     \r\n        {stores}\r\n      </div>\r\n    </div>\r\n  </section>\r\n  '})}}const s={"creditCard.cardNumber":{presence:{allowEmpty:!1},format:{pattern:/^\d{13,16}$/,message:"must be a numeric value with 13 to 16 digits"}},"creditCard.exp":{presence:{allowEmpty:!1},format:{pattern:/^(0[1-9]|1[0-2])\/([0-9]{2})$/,message:"must be in the format MM/YY (e.g., 12/23)"}},"creditCard.zipCode":{presence:{allowEmpty:!1},format:{pattern:/^\d{5}$/,message:"must be a 5-digit number"}},"creditCard.cvv":{presence:{allowEmpty:!1},format:{pattern:/^\d{3,4}$/,message:"must be a 3 or 4 digit number"}},phone:{presence:{allowEmpty:!1},format:{pattern:/^\d{10}$/,message:"must be a numeric value with 10 digits"}}};var a=(t=>(t.MANUAL="manual",t.AUTOMATIC="automatic",t))(a||{});class CardReaderComponent extends BaseComponent{constructor(t,e){super(t),__publicField(this,"videoElement"),__publicField(this,"captureButton"),__publicField(this,"acceptButton"),__publicField(this,"processingIndicator"),__publicField(this,"cameraErrorElement"),__publicField(this,"cardNumberResult"),__publicField(this,"expirationDateResult"),__publicField(this,"scanErrorMessage"),__publicField(this,"stream",null),__publicField(this,"canvas"),__publicField(this,"scanInterval",Number("1000")||1e3),__publicField(this,"scanIntervalId",null),__publicField(this,"isProcessing",!1),__publicField(this,"scanMode","manual"),__publicField(this,"onCardDataExtracted"),__publicField(this,"extractedCardNumber",null),__publicField(this,"extractedExpirationDate",null),__publicField(this,"handleCaptureClick",(()=>{this.scanMode===a.AUTOMATIC?this.startAutomaticScanning():this.captureImage()})),__publicField(this,"handleAcceptClick",(()=>{this.acceptResults()})),this.onCardDataExtracted=e,this.canvas=document.createElement("canvas")}init(){this.videoElement=this.$("#camera-feed"),this.captureButton=this.$("#capture-button"),this.acceptButton=this.$("#accept-button"),this.processingIndicator=this.$("#processing-indicator"),this.cameraErrorElement=this.$("#camera-error"),this.cardNumberResult=this.$("#card-number-result"),this.expirationDateResult=this.$("#expiration-date-result"),this.scanErrorMessage=this.$("#scan-error-message"),this.initCamera(),this.captureButton.addEventListener("click",this.handleCaptureClick),this.acceptButton.addEventListener("click",this.handleAcceptClick),this.configureScanMode()}clean(){this.stopAutomaticScanning(),this.stream&&(this.stream.getTracks().forEach((t=>t.stop())),this.stream=null),this.captureButton&&this.captureButton.removeEventListener("click",this.handleCaptureClick),this.acceptButton&&this.acceptButton.removeEventListener("click",this.handleAcceptClick),this.videoElement=null,this.captureButton=null,this.acceptButton=null,this.processingIndicator=null,this.cameraErrorElement=null,this.cardNumberResult=null,this.expirationDateResult=null,this.scanErrorMessage=null,this.extractedCardNumber=null,this.extractedExpirationDate=null,this.isProcessing=!1}configureScanMode(){this.scanMode===a.AUTOMATIC?(this.captureButton.disabled=!0,this.captureButton.style.display="none",this.acceptButton.style.display="none",this.startAutomaticScanning()):this.captureButton.disabled=!1}async initCamera(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}},audio:!1}),this.videoElement.srcObject=this.stream,this.cameraErrorElement.classList.add("hidden")}catch(t){this.cameraErrorElement.classList.remove("hidden"),this.cameraErrorElement.classList.add("flex")}}startAutomaticScanning(){null===this.scanIntervalId&&(this.scanIntervalId=window.setInterval((()=>{this.isProcessing||this.captureImage()}),this.scanInterval))}stopAutomaticScanning(){null!==this.scanIntervalId&&(window.clearInterval(this.scanIntervalId),this.scanIntervalId=null)}captureImage(){if(!this.stream||this.isProcessing)return;this.isProcessing=!0,this.processingIndicator.classList.remove("hidden"),this.processingIndicator.classList.add("flex"),this.scanErrorMessage.classList.add("hidden");const{videoWidth:t,videoHeight:e}=this.videoElement;this.canvas.width=t,this.canvas.height=e;const r=this.canvas.getContext("2d");if(r){r.drawImage(this.videoElement,0,0,t,e);const n=this.canvas.toDataURL("image/jpeg",.8);this.processImage(n)}else this.handleProcessingError("Canvas context could not be created")}async processImage(t){try{const e=await this.apiService.getCardInfo(t);this.extractCardDetails(e)}catch(e){this.handleProcessingError("Error processing image")}}extractCardDetails(t){try{const{cardNumber:e,expDate:r}=t;e&&(this.extractedCardNumber=e,this.cardNumberResult.textContent=this.formatCardNumber(e)),r&&(this.extractedExpirationDate=r,this.expirationDateResult.textContent=r),this.extractedCardNumber&&this.extractedExpirationDate?(this.acceptButton.classList.remove("hidden"),this.scanMode===a.AUTOMATIC&&this.stopAutomaticScanning(),this.onCardDataExtracted&&this.onCardDataExtracted(this.extractedCardNumber,this.extractedExpirationDate)):(this.scanErrorMessage.textContent="Card details partially detected. Try again with better positioning.",this.scanErrorMessage.classList.remove("hidden"))}catch(e){this.handleProcessingError("Could not extract card details from image")}finally{this.isProcessing=!1,this.processingIndicator.classList.add("hidden"),this.processingIndicator.classList.remove("flex")}}formatCardNumber(t){return t.replace(/(\d{4})(?=\d)/g,"$1 ")}handleProcessingError(t){this.scanErrorMessage.textContent=t,this.scanErrorMessage.classList.remove("hidden"),this.isProcessing=!1,this.processingIndicator.classList.add("hidden"),this.processingIndicator.classList.remove("flex")}acceptResults(){this.extractedExpirationDate||(this.extractedExpirationDate=""),this.extractedCardNumber||(this.extractedCardNumber=""),this.onCardDataExtracted&&this.onCardDataExtracted(this.extractedCardNumber,this.extractedExpirationDate)}getCardData(){return this.extractedCardNumber&&this.extractedExpirationDate?{cardNumber:this.extractedCardNumber,expirationDate:this.extractedExpirationDate}:null}reset(){this.extractedCardNumber=null,this.extractedExpirationDate=null,this.cardNumberResult.textContent="Waiting for scan...",this.expirationDateResult.textContent="Waiting for scan...",this.acceptButton.classList.add("hidden"),this.scanErrorMessage.classList.add("hidden")}}class RegisterFormComponent extends PageBaseComponent{constructor(t){super(t),__publicField(this,"form"),__publicField(this,"errorSpan"),__publicField(this,"cardNumberInput"),__publicField(this,"expInput"),__publicField(this,"phoneInput"),__publicField(this,"scanCardBtn"),__publicField(this,"modalCloseBtn"),__publicField(this,"modalCloseIcon"),__publicField(this,"modalContainer"),__publicField(this,"modalContentContainer"),__publicField(this,"numberOfPumps"),__publicField(this,"constraints"),__publicField(this,"cardReaderComponent"),this.numberOfPumps=this.state.numberOfPumps,this.constraints=s,this.cardReaderComponent=new CardReaderComponent(this.store,this.onCardDataExtracted.bind(this))}onCardDataExtracted(t,e){this.hideModal(),this.cardNumberInput.value=t,this.expInput.value=e}attachEvents(){this.form=this.$("form"),this.errorSpan=this.$("#error"),this.cardNumberInput=this.$("#card-number-input"),this.expInput=this.$("#card-expiration-input"),this.phoneInput=this.$("#mobile-phone-input"),this.scanCardBtn=this.$("#scan-card-btn"),this.modalContainer=this.$("#modal-container"),this.modalCloseBtn=this.$("#modal-close-btn"),this.modalCloseIcon=this.$("#modal-close-icon"),this.modalContentContainer=this.$("#modal-content"),this.populatePumpDropdown(),this.preventNonNumericValues(this.form,["#card-number-input","#zipcode","#cvv-input","#mobile-phone-input"]),this.setupInputFormatting(),this.form.addEventListener("submit",(t=>this.handleSubmit(t))),this.scanCardBtn.addEventListener("click",(()=>this.viewModal())),this.modalCloseBtn.addEventListener("click",(()=>this.hideModal())),this.modalCloseIcon.addEventListener("click",(()=>this.hideModal()))}viewModal(){this.modalContainer.style.display="block",this.modalContentContainer.innerHTML=this.cardReaderComponent.render(),this.cardReaderComponent.init()}hideModal(){this.modalContainer.style.display="none",this.modalContentContainer.innerHTML="",this.cardReaderComponent.clean()}populatePumpDropdown(){const t=this.$("#pump-number");t.innerHTML="";for(let e=1;e<=this.numberOfPumps;e++){const r=document.createElement("option");r.value=e.toString(),r.textContent=`Pump ${e}`,t.appendChild(r)}}async handleSubmit(t){t.preventDefault(),t.stopPropagation(),this.errorSpan.textContent="";const r=this.getFormData(),n=i.validate(r,this.constraints);if(n)this.errorSpan.textContent=Object.values(n)[0][0];else try{const{phone:t,creditCard:n,...i}=r,{_id:s}=await this.apiService.registerCustomer(t,n,Object.keys(i).length?i:void 0);this.store.setState({...r,customerId:s,phone:r.phone,chosenPumpNumber:Number(this.$("#pump-number").value??0)}),this.store.transitionTo(e.IN_OTP_FORM)}catch{this.store.transitionTo(e.ERROR)}}getFormData(){return{phone:this.phoneInput.value,creditCard:{cardNumber:this.cardNumberInput.value.replace(/\s/g,""),exp:this.expInput.value,zipCode:this.$("#zipcode").value,cvv:this.$("#cvv-input").value}}}setupInputFormatting(){this.cardNumberInput.addEventListener("input",(()=>this.handleCardNumberInput())),this.expInput.addEventListener("input",(()=>this.handleExpInput()))}handleCardNumberInput(){const t=this.cardNumberInput.value.replace(/\D/g,"").slice(0,16);this.cardNumberInput.value=t.replace(/(\d{4})(?=\d)/g,"$1 ").trim()}handleExpInput(){const t=this.expInput.value.replace(/\D/g,"").slice(0,4);this.expInput.value=t.length>=3?`${t.slice(0,2)}/${t.slice(2)}`:t}}class StoreCardComponent extends PageBaseComponent{constructor(t,e={}){super(t),__publicField(this,"card"),this.storeData=e}templateData(){var t,e,r,n,i,s,a,o,l,c,d;return{...this.storeData,streetAddress:(null==(e=null==(t=this.storeData)?void 0:t.address)?void 0:e.streetAddress)||"unkown street",city:(null==(n=null==(r=this.storeData)?void 0:r.address)?void 0:n.city)||"unkown city",stateCode:(null==(s=null==(i=this.storeData)?void 0:i.address)?void 0:s.stateCode)||"unkown state",latitude:(null==(o=null==(a=this.storeData)?void 0:a.geoLocation)?void 0:o.latitude)||"00",longitude:(null==(c=null==(l=this.storeData)?void 0:l.geoLocation)?void 0:c.longitude)||"00",isOnline:(null==(d=this.storeData)?void 0:d.isOnline)?"Online":"Offline"}}attachEvents(){this.card=this.$(`#id-${this.storeData.storeId}`),this.card.addEventListener("click",(()=>this.handleCardClick()))}handleCardClick(){this.store.setState({chosenStoreId:this.storeData.storeId??"",chosenStorePosition:this.storeData.geoLocation,numberOfPumps:this.storeData.numberOfPumps??0});const t=new URLSearchParams(window.location.search).get("mode")||"";this.store.transitionTo("full"===t?e.REGISTER_EXTENDED_FORM:e.REGISTER_FORM)}}class StoresComponent extends PageBaseComponent{constructor(t){super(t),__publicField(this,"stores",[]),__publicField(this,"cardsComponents",[]),this.stores=this.state.stores,this.cardsComponents=this.stores.map((t=>new StoreCardComponent(this.store,t)))}getStoreCards(){return this.cardsComponents.map((t=>t.render())).join("")}templateData(){return{stores:this.getStoreCards()}}attachEvents(){this.cardsComponents.forEach((t=>{t.attachEvents()}))}}class RegisterExtendedFormComponent extends RegisterFormComponent{constructor(t){super(t),__publicField(this,"firstNameInput"),__publicField(this,"lastNameInput"),__publicField(this,"emailInput"),__publicField(this,"passwordInput"),__publicField(this,"pinCodeInput"),this.constraints=s}attachEvents(){super.attachEvents(),this.firstNameInput=this.$("#first-name"),this.lastNameInput=this.$("#last-name"),this.emailInput=this.$("#email"),this.passwordInput=this.$("#password"),this.pinCodeInput=this.$("#pin-code"),this.preventNonNumericValues(this.form,["#pin-code"])}getFormData(){return{...super.getFormData(),firstName:this.firstNameInput.value.trim(),lastName:this.lastNameInput.value.trim(),email:this.emailInput.value.trim(),password:this.passwordInput.value,pinCode:this.pinCodeInput.value}}}class OtpFormComponent extends PageBaseComponent{constructor(){super(...arguments),__publicField(this,"inputs"),__publicField(this,"errorSpan"),__publicField(this,"form")}attachEvents(){this.inputs=this.$_all('input[name^="otp"]'),this.errorSpan=this.$("#error"),this.form=this.$("form"),this.inputs.forEach(((t,e)=>{t.addEventListener("input",(()=>this.handleInput(t,e))),t.addEventListener("keydown",(t=>this.handleBackspace(t,e))),t.addEventListener("paste",(t=>this.handlePaste(t)))})),this.form.addEventListener("submit",(t=>this.handleSubmit(t)))}handleInput(t,e){t.value=t.value.slice(0,1);const r=this.inputs[e+1];t.value&&r&&r.focus()}handleBackspace(t,e){const r=t.target;if("Backspace"===t.key){if(""===r.value){const t=this.inputs[e-1];t&&t.focus()}else r.value="";t.preventDefault()}}handlePaste(t){var e;t.preventDefault();const r=((null==(e=t.clipboardData)?void 0:e.getData("text"))||"").replace(/\D/g,"").split("");r.length===this.inputs.length&&this.inputs.forEach(((t,e)=>t.value=r[e]||""))}async handleSubmit(t){t.preventDefault(),this.errorSpan.innerHTML="";const r=this.getFormData();if(r.length===this.inputs.length)try{await this.apiService.verifySmsToken(this.state.customerId,r,{position:this.state.chosenStorePosition||this.state.position,storeId:this.state.chosenStoreId,pumpNumber:this.state.chosenPumpNumber}),this.store.transitionTo(e.FINAL)}catch{this.store.transitionTo(e.ERROR)}else this.errorSpan.innerHTML="OTP must be 6 digits"}getFormData(){return Array.from(this.inputs).map((t=>t.value)).join("")}}class CanceledComponent extends BaseComponent{constructor(t,e){super(t),__publicField(this,"message"),this.message=e}templateData(){return{message:this.message}}}class ErrorComponent extends CanceledComponent{buildTemplatePath(){return"./canceled/canceled.template.html"}}class FinalComponent extends PageBaseComponent{}class Renderer{constructor(t){__publicField(this,"appElement"),__publicField(this,"currentComponent",null),__publicField(this,"messages",{cancel:"Please see an attendant inside to pay for fuel",error:"Something went wrong, please see an attendant inside to pay for fuel"}),this.componentFactory=t,this.appElement=document.getElementById("app")}update(t,e){this.appElement&&(this.currentComponent=this.componentFactory(t.state,e),this.appElement.innerHTML=this.currentComponent.render(),this.currentComponent.attachEvents())}}class Store{constructor(t,e,r,n){__publicField(this,"subscriber",null),__publicField(this,"OTP_COOKIE_KEY","otpState"),__publicField(this,"storeCookieState"),__publicField(this,"deleteCookieState"),__publicField(this,"excludeFromCookie"),__publicField(this,"initialState"),__publicField(this,"state"),this.initialState=t,this.state=this.initialState,this.storeCookieState=e,this.deleteCookieState=r,this.excludeFromCookie=n,this.loadStoredState()}getState(){return this.state}setState(t){this.state={...this.state,...t}}transitionTo(t){this.state.state=t,t===this.storeCookieState?this.storeOtpState():t===this.deleteCookieState&&this.deleteStoredState(),this.notifySubscriber()}storeOtpState(){const t=(e=this.state,r=this.excludeFromCookie,Object.fromEntries(Object.entries(e).filter((([t])=>!r.includes(t)))));var e,r;const n="https:"===window.location.protocol;document.cookie=`${this.OTP_COOKIE_KEY}=${encodeURIComponent(JSON.stringify(t))};path=/;max-age=120${n?";secure":""}`}subscribe(t){this.subscriber=t}notifySubscriber(){this.subscriber&&this.subscriber.update(this.state,this)}setInitialState(){this.setState(this.initialState)}loadStoredState(){const t=this.getCookie(this.OTP_COOKIE_KEY);if(t)try{const e=JSON.parse(decodeURIComponent(t));this.state={...this.initialState,...e},this.notifySubscriber()}catch{this.state=this.initialState}}deleteStoredState(){document.cookie=`${this.OTP_COOKIE_KEY}=;path=/;max-age=0;`}getCookie(t){const e=document.cookie.match(new RegExp(`(^| )${t}=([^;]+)`));return e?e[2]:null}}const o={state:e.INITIAL,position:{longitude:"",latitude:""},stores:[],chosenStoreId:"",chosenStorePosition:{latitude:"",longitude:""},numberOfPumps:0,chosenPumpNumber:0,creditCard:{cardNumber:"",exp:"",zipCode:"",cvv:""},phone:"",customerId:""};window.addEventListener("load",(async function(){const t=new ApiService,r=new Store(o,e.IN_OTP_FORM,e.FINAL,["creditCard","stores"]),n=new Renderer(function(){const t={[e.INITIAL]:t=>new InitialComponent(t),[e.REGISTER_FORM]:t=>new RegisterFormComponent(t),[e.STORES_PAGE]:t=>new StoresComponent(t),[e.REGISTER_EXTENDED_FORM]:t=>new RegisterExtendedFormComponent(t),[e.IN_OTP_FORM]:t=>new OtpFormComponent(t),[e.ERROR]:t=>new ErrorComponent(t,"Something went wrong, please see an attendant inside to pay for fuel"),[e.FINAL]:t=>new FinalComponent(t)};return(r,n)=>t[r]?t[r](n):t[e.ERROR](n)}());r.subscribe(n);const i=r.getState().state;if(i===e.INITIAL)try{navigator.geolocation.getCurrentPosition((async function(n){r.setState({position:{longitude:`${n.coords.longitude}`,latitude:`${n.coords.latitude}`}}),r.transitionTo(e.INITIAL);const{data:i}=await t.listStores(r.getState().position);r.setState({stores:i??[]}),r.transitionTo(e.STORES_PAGE)}),(async function(){r.setState({position:{longitude:"28.186879730583183",latitude:"-82.40479285767222"}}),r.transitionTo(e.INITIAL);const{data:n}=await t.listStores(r.getState().position);r.setState({stores:n??[]}),r.transitionTo(e.STORES_PAGE)}))}catch(s){r.transitionTo(e.ERROR)}else r.transitionTo(i)}));
